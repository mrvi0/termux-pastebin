# Changelog (Журнал изменений)

Все заметные изменения в этом проекте будут документироваться в этом файле.

Формат основан на [Keep a Changelog](https://keepachangelog.com/ru/1.0.0/),
и проект придерживается [Семантического Версионирования](https://semver.org/spec/v2.0.0.html).

## [0.4.0] - 2025-04-27

### Added
- **Авторизация через Яндекс.OAuth:**
    - Добавлены страницы входа и обработки callback от Яндекса.
    - Реализовано создание/обновление пользователей в локальной БД на основе данных Яндекса.
    - Используется сессия Flask для хранения статуса авторизации.
- **Функционал "Мои пасты":**
    - Добавлена страница `/my-pastes` для просмотра паст авторизованного пользователя.
    - Пасты теперь привязываются к `user_id` при создании авторизованным пользователем.
- Добавлены зависимости `Authlib`, `types-sqlite3` (опционально).
- Реализована favicon.

### Changed
- Структура базы данных: добавлена таблица `users`, в таблицу `pastes` добавлено поле `user_id`.
- Логика создания пасты (`/` POST) теперь учитывает `user_id` из сессии.
- Обновлены шаблоны (`base.html`, `home.html`, `view_paste.html`) для поддержки авторизации и новой навигации.
- Путь к базе данных и шаблонам теперь находится внутри папки `src`.
- Улучшена обработка ошибок `TemplateNotFound`.
- Код адаптирован для использования `contextlib.suppress` вместо `try-except-pass` (SIM105).
- Обновлены зависимости в `requirements.txt`.

### Removed
- Удалена базовая HTTP-аутентификация (Basic Auth).

### Fixed
- Исправлена ошибка `TypeError` при распаковке результата `get_paste` в `app.py`.
- Исправлена ошибка `TypeError` при сортировке администраторов (актуально для `admin-bot`, не для pastebin).
- Исправлена ошибка `AttributeError` или `TypeError` при установке таймаутов и `tzinfo` в `python-telegram-bot` (актуально для `admin-bot`).
- Исправлена ошибка `NameError: name 'Optional' is not defined` из-за отсутствия импортов `typing`.
- Исправлена ошибка Mypy `Call to untyped function "cursor"` добавлением аннотаций/`types-sqlite3`.
- Исправлена ошибка `jinja2.exceptions.UndefinedError: 'str object' has no attribute 'strftime'` путем корректного преобразования timestamp из SQLite.
- Исправлена ошибка `Method Not Allowed` для роута `/logout`.

---

## [0.3.2] - 2025-04-27

### Added
- lint.yml
- scripts/format.sh
- scripts/lint.sh

---

## [0.3.1] - 2025-04-27

### Fixed
- name 'username' is not defined

## [0.3.0] - 2025-04-27

### Added
- Создан файл `CHANGELOG.md`.
- Добавлены шаблоны и базовая структура Flask приложения.
- Реализована работа с базой данных SQLite для хранения паст.
- Добавлен скрипт запуска через Waitress (`scripts/run_prod.sh`).
- Настроен автозапуск через Termux:Boot.
- Настроен CI/CD через GitHub Actions для деплоя.

### Changed
- Зависимости вынесены в `requirements.txt`.
- Конфигурация переведена на переменные окружения (`.env` файл).
- Улучшена структура проекта с использованием папки `src`.
- Логика работы с БД вынесена в `src/database.py`.
- Логика запуска вынесена в `scripts/run_prod.sh`.
- Улучшено логирование и обработка ошибок.

### Removed
- Удалена базовая HTTP-аутентификация для создания паст.

### Fixed
- Исправлены ошибки с путями к шаблонам (`TemplateNotFound`).
- Исправлены ошибки с правами доступа и форматом исполняемых файлов при запуске в Termux.
- Исправлены ошибки импорта и зависимостей (`Flask`, `typing`, `HTTPXRequest`, `pytz`/`zoneinfo`).
- Исправлены ошибки парсинга Markdown V2 в уведомлениях Telegram Actions.
- Решена проблема с `ssh-keyscan` в GitHub Actions путем деплоя через VPS.
- Исправлена ошибка `TypeError` при сортировке списка администраторов.
- Исправлена ошибка `Chat not found` при отправке уведомлений нескольким администраторам.

---

## [0.2.0] - 2025-04-26

### Added (Добавлено)
*   добавление/просмотр паст

### Changed (Изменено)
*   -

### Deprecated (Устарело)
*   -

### Removed (Удалено)
*   -

### Fixed (Исправлено)
*   ошибки с путями к темлейтам

### Security (Безопасность)
*   все супер безопасно, пока я сам не сломаю :D 

---

## [0.1.0] - 2025-04-26

### Added
*   Первоначальный выпуск проекта
